<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hy.salon.basic.dao" >


    <select id="GET_PRODUCT_LIST"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.entity.Product">

     SELECT * FROM salon.product WHERE salon_id=#{salonId};

    </select>



    <select id="GET_PRODUCT_BY_STATUS"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.vo.StockTransferApplicationVo">

        SELECT
            a.record_id,
            a.application_no,
            a.out_warehouse_id,
            a.remark_application,
            a.remark_audit,
            a.record_status,
            a.record_id,
            b.qty,
            b.stock_transfer_application_id,
            b.product_id,
            c.salon_id,
            c.product_name,
            c.product_class,
            c.product_series_id,
            c.price_market,
            c.price
        FROM
            `stock_transfer_application` a
        LEFT JOIN stock_transfer_application_item b on a.record_id = b.stock_transfer_application_id
        LEFT JOIN product c ON b.product_id=c.record_id
        where a.record_status=#{recordStatus};

    </select>
    <select id="GET_PRODUCT_BY_TYPE"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.vo.ProductStockMovementVo">

        select
              a.*,
              b.salon_id,
              b.product_name,
              b.product_class,
              b.product_series_id,
              b.price_market,
              b.price,
              b.product_code,
              b.specification,
              b.specification_unit,
              b.product_unit_id,
              b.bar_code,
              b.shelf_life,
              b.day_of_pre_warning,
              b.stock_of_pre_warning,
              b.record_status,
              b.description,
              c.stock_qty,
              c.cost
        from
              product_stock_movement a
        LEFT JOIN product b on a.product_id=b.record_id
        LEFT JOIN product_stock c on a.product_id=c.product_id
        where a.movement_type=#{movementType}
        and a.create_date between #{cTime} and #{eTime};
    </select>



    <select id="GET_SERVICE_FOR_SUIT"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.vo.ServiceVo">

     SELECT ss.*,sss.times,sss.service_id,sss.service_suite_id FROM salon.service as ss left join salon.service_suite_item as sss on ss.record_id= sss.service_id
      where sss.service_suite_id= #{id};

    </select>


    <select id="GET_BIN_SERVICE_SERIES_FOR_PARENTId"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.vo.ServiceSeriesVo">

    SELECT sss.*,svsi.record_id FROM salon.service_series as sss left join salon.vip_suite_item as svsi on sss.record_id = svsi.item_id
    where sss.parent_id= #{parentId} and svsi.record_type = #{recordType} and svsi.vip_suite_id = #{vipSuiteId};

    </select>


    <select id="GET_SERVICE_SERIES_FOR_PARENTId"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.vo.ServiceSeriesVo">

    SELECT * FROM salon.service_series where parent_id= #{parentId};

    </select>


    <select id="GET_PRODUCT_FOR_SERIES"  parameterType="java.util.Map" resultType="java.util.Map">

   SELECT * FROM salon.product_series left join salon.product on product_series.record_id = product.product_series_id
    where product_series.series_name = #{seriesName} and product.salon_id = #{salonId};

    </select>

    <select id="GET_STUFF_NAME"  parameterType="java.util.Map" resultType="com.hy.salon.basic.vo.StuffVo">
        select
            a.job_name
        from job a
        LEFT JOIN stuff_job b on a.record_id=b.job_id
        where b.stuff_id=#{stuffId};
    </select>

    <select id="GET_SCHEDULE_BY_TIME"  parameterType="java.util.Map" resultType="com.hy.salon.basic.vo.ShiftVo">
        SELECT
            a.record_id as recordId,
            a.store_id as storeId,
            a.shift_type as shiftType,
            a.time_start as timeStart,
            a.time_end as timeEnd,
            b.stuff_id as stuffId,
            c.stuff_name as stuffName,
            b.shift_id as shiftId,
            b.`day` as day
        FROM
            shift a
        LEFT JOIN `schedule` b ON a.shift_type = b.shift_id

        LEFT JOIN stuff c ON b.stuff_id = c.record_id
        WHERE
            a.store_id=#{storeId}
        and b.`day` between #{timeStart} and #{timeEnd};
    </select>



    <select id="GET_ROLE_BY_USERID"  parameterType="java.util.Map" resultMap="com.zhxh.admin.entity.SystemRole">

     SELECT role.* FROM salon.system_role as role left join salon.role_user as roleuser on role.record_id= roleuser.role_id
      where roleuser.user_id= #{userId};

    </select>

    <select id="GET_JOB_BY_USERID"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.entity.Job">

     SELECT job.* FROM salon.job as job left join salon.stuff_job as stuffjob on job.record_id= stuffjob.job_id
      where stuffjob.stuff_id= #{stuffId};

    </select>


    <!--    <select id="GET_JOB_BY_USERID"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.entity.Job">

         SELECT job.* FROM salon.job as job left join salon.stuff_job as stuffjob on job.record_id= stuffjob.job_id
          where stuffjob.stuff_id= #{stuffId};

        </select>-->

    <select id="GET_RESERVATION_BY_TIME"  parameterType="java.util.Map" resultMap="com.hy.salon.basic.vo.StoreReservation">
        select Room.sName salon_name ,Room.recordId as salon_id , count(reserva.record_id ) as reservation_count from
        (select s.record_id as recordId,s.salon_name as sName,room.room_name as rName,room.record_id as roomId
        from salon s  join store_room room on s.record_id=room.store_id) as Room  join reservation reserva on Room.roomId = reserva.room_id
         where DATE_FORMAT(reserva.time_start,'%Y%m%d')=#{timeStart} GROUP BY Room.sName,Room.recordId
    </select>
</mapper>